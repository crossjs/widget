<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src\widget.js - widget</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="widget"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 1.0.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/Widget.html">Widget</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/Widget.html">Widget</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: src\widget.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
define(function (require, exports, module) {

/**
 * 组件基类
 *
 * @module Widget
 */

&#x27;use strict&#x27;;

var $ = require(&#x27;$&#x27;),
  Base = require(&#x27;base&#x27;);

var DELEGATE_SPLITTER = /^(\S+)\s*(.*)$/,
  DELEGATE_NAMESPACE = &#x27;.delegate-widget-&#x27;,
  DATA_WIDGET_UNIQUEID = &#x27;data-widget-uid&#x27;;

var cachedInstances = {};

// TODO: 检查是否有内存泄漏发生

/**
 * 组件基类
 *
 * @class Widget
 * @constructor
 * @extends Base
 *
 * @example
 * &#x60;&#x60;&#x60;
 * // 创建子类
 * var PersonWidget = Widget.extend({
 *   setup: function () {
 *     // 通知事件 &#x60;setup&#x60;
 *     this.fire(&#x27;setup&#x27;, this.option(&#x27;name&#x27;), this.option(&#x27;age&#x27;));
 *   }
 * });
 * // 创建子类实例
 * var tom = new PersonWidget({
 *   name: &#x27;Tom&#x27;,
 *   age: 21,
 *   // 订阅事件
 *   events: {
 *     // &#x60;setup&#x60;
 *     setup: function (e, name, age) {
 *       // e.type === &#x27;setup&#x27;
 *       // name === &#x27;Tom&#x27;
 *       // age === 21
 *       // this === tom
 *     },
 *     // AOP &#x60;before:setup&#x60;
 *     &#x27;before:setup&#x27;: function (e) {
 *       // 执行 &#x60;setup&#x60; 方法前执行
 *       // 此处返回 &#x60;false&#x60; 将阻止 &#x60;setup&#x60; 方法执行
 *     },
 *     // AOP &#x60;before:setup&#x60;
 *     &#x27;before:setup&#x27;: function (e) {
 *       // 执行 &#x60;setup&#x60; 方法后执行
 *       // 如果 &#x60;setup&#x60; 方法被阻止，就不会执行到这里
 *     }
 *   },
 *   // 代理事件
 *   delegates: {
 *     &#x27;click&#x27;: function (e) {
 *       // e.target === this.element[0]
 *       // this === tom
 *     },
 *     &#x27;mouseover .avatar&#x27;: function (e) {
 *       // 鼠标悬停在 element 里的 &#x60;.avatar&#x60; 元素
 *     }
 *   }
 * });
 * &#x60;&#x60;&#x60;
 */
var Widget = Base.extend({

  /**
   * 初始化函数，将自动执行；实现事件自动订阅与初始化组件参数
   *
   * @method initialize
   * @param {Object} options 组件参数
   */
  initialize: function (options) {
    var self = this;

    Widget.superclass.initialize.apply(self, arguments);

    // self.UI = {
    //   &#x27;default&#x27;: {}
    // };

    /**
     * 实例唯一ID
     *
     * @property {String} uniqueId
     */
    self.uniqueId = uniqueId();

    /**
     * 用于 DOM 事件绑定的 NAMESPACE
     *
     * @property {String} delegateNS
     */
    self.delegateNS = DELEGATE_NAMESPACE + self.uniqueId;

    self.initCnE();

    self.initDnV();

    self.initDelegates();

    self.initTrigger();

    self.setup();

    // 储存实例
    cachedInstances[self.uniqueId] = self;
  },

  /**
   * 默认参数，子类自动继承并覆盖
   *
   * @property {Object} defaults
   * @type {Object}
   */
  defaults: {
    // 默认插入到的容器，设置为 &#x60;null&#x60; 则不执行插入
    container: &#x27;body&#x27;,
    classPrefix: &#x27;ue-component&#x27;,
    // CSS表，初始化时自动设置
    css: {
    },
    // TODO: ue-component 改成 pandora 之类的，以与旧版组件做区别？
    element: &#x27;&lt;div&gt;&lt;/div&gt;&#x27;,
    // 实现 element 插入到 DOM，基于 container
    insert: function () {
      this.container.length &amp;&amp; this.container.append(this.element);
    }
  },

  /**
   * 寻找 element 后代，参数为空时，返回 element
   *
   * @method $
   * @param {Mixed} [selector] 选择符
   * @return {Object} jQuery 包装的 DOM 节点
   */
  $: function (selector) {
    return selector ? this.element.find(selector) : this.element;
  },

  /**
   * 获取 role 对应的元素，通过 [data-role=xxx]
   *
   * @method role
   * @param {Mixed} role data-role 的值
   * @return {Object} jQuery 包装的 DOM 节点
   */
  role: function (role) {
    return this.$(&#x27;[data-role=&#x27; + role + &#x27;]&#x27;);
  },

  /**
   * 初始化 &#x60;container&#x60; 与 &#x60;element&#x60;
   *
   * @method initCnE
   * @return {Object} 当前实例
   */
  initCnE: function () {
    /**
     * 容器/插入参考点
     *
     * @property {Object} container（容器
     */
    this.container = $(this.option(&#x27;container&#x27;));

    /**
     * 组件根元素
     *
     * @property {Object} element
     */
    this.element = $(this.option(&#x27;element&#x27;))
        .attr(DATA_WIDGET_UNIQUEID, this.uniqueId)
        .addClass(this.option(&#x27;classPrefix&#x27;))
        .css(this.option(&#x27;css&#x27;));

    return this;
  },

  /**
   * 初始化 &#x60;document&#x60; 与 &#x60;viewport&#x60;
   *
   * @method initDnV
   * @return {Object} 当前实例
   */
  initDnV: function () {
    /**
     * &#x60;element&#x60; 所在的 &#x60;document&#x60; 对象
     *
     * @property {Document} document
     */
    this.document = this.element.prop(&#x27;ownerDocument&#x27;);

    /**
     * &#x60;element&#x60; 所在的 &#x60;window&#x60; 对象
     *
     * @property {Window} viewport
     */
    this.viewport = (function (doc) {
      return doc.defaultView || doc.parentWindow;
    })(this.document);

    return this;
  },

  /**
   * 事件代理，绑定在 element 上
   *
   * @method initDelegates
   * @param {Object|Function} [delegates] 代理事件列表
   * @return {Object} 当前实例
   */
  initDelegates: function (delegates) {
    var self = this;

    delegates || (delegates = self.option(&#x27;delegates&#x27;));

    if (!delegates) {
      return self;
    }

    if (typeof delegates === &#x27;function&#x27;) {
      delegates = delegates.call(self);
    }

    $.each(delegates, function (key, callback) {
      var match = key.match(DELEGATE_SPLITTER),
        event = match[1] + self.delegateNS;

      if (typeof callback === &#x27;string&#x27;) {
        callback = self[callback];
      }

      if (match[2]) {
        self.element.on(event, match[2], function () {
          callback.apply(self, arguments);
        });
      } else {
        self.element.on(event, function () {
          callback.apply(self, arguments);
        });
      }
    });

    return self;
  },

  /**
   * 显示触发器
   *
   * @method initTrigger
   * @param {String} [trigger] 触发器
   * @return {Object} 当前实例
   */
  initTrigger: function (trigger) {
    var self = this;

    trigger || (trigger = self.option(&#x27;trigger&#x27;));

    if (!trigger) {
      return self;
    }

    $(self.document)
      .on(&#x27;click&#x27; + self.delegateNS, trigger, function (e) {
        e.preventDefault();

        self.activeTrigger = e.currentTarget;

        if (!self.rendered) {
          self.render();
        }

        self.show();
      });

    self.hide();

    return self;
  },

  /**
   * 自动执行的设置函数，预留用于子类覆盖
   *
   * @method setup
   */
  setup: function () {
  },

  /**
   * 插入elemnt到container
   * @method render
   * @return {Object} 当前实例
   */
  render: function () {
    var self = this,
      content,
      template = self.option(&#x27;template&#x27;);

    if (typeof template === &#x27;function&#x27;) {
      content = template(self.data());
    } else {
      content = self.option(&#x27;content&#x27;);
    }

    if (typeof content !== &#x27;undefined&#x27;) {
      self.element.html(content);
    }

    if (!self.rendered) {
      // 插入到容器中
      self.option(&#x27;insert&#x27;).call(self);

      self.rendered = true;
    }

    /**
     * 通知渲染
     *
     * @event render
     * @param {Object} e Event.
     */
    self.fire(&#x27;render&#x27;);

    return self;
  },

  /**
   * 判断：显示状态等，参见 &#x60;jq&#x60; 的 &#x60;is&#x60;
   *
   * @example
   * &#x60;&#x60;&#x60;
   * instance.is(&#x27;:hidden&#x27;)
   * &#x60;&#x60;&#x60;
   *
   * @method is
   * @param {Mixed} condition 判断语句
   * @return {Boolean}
   */
  is: function (contidtion) {
    return this.element.is(contidtion);
  },

  /**
   * 显示
   *
   * @method show
   * @return {Object} 当前实例
   */
  show: function () {
    this.element.show();

    /**
     * 通知显示
     *
     * @event show
     * @param {Object} e Event.
     */
    this.fire(&#x27;show&#x27;);

    return this;
  },

  /**
   * 隐藏
   *
   * @method hide
   * @return {Object} 当前实例
   */
  hide: function () {
    this.element.hide();

    /**
     * 通知隐藏
     *
     * @event hide
     * @param {Object} e Event.
     */
    this.fire(&#x27;hide&#x27;);

    return this;
  },

  /**
   * 销毁当前组件对象
   * @method destroy
   */
  destroy: function () {
    /**
     * 通知销毁
     *
     * @event destroy
     * @param {Object} e Event.
     */
    this.fire(&#x27;destroy&#x27;);

    // 移除 element 事件代理
    this.element &amp;&amp; this.element.off(this.delegateNS);

    // 移除 document 事件代理
    this.trigger &amp;&amp; this.document &amp;&amp; $(this.document).off(this.delegateNS);

    // 从DOM中移除element
    this.element.remove();

    Widget.superclass.destroy.apply(this);
  }

});

var uniqueId = (function () {
  var ids = {};
  return function () {
    var id = Math.random().toString(36).substr(2);
    if (ids[id]) {
      return uniqueId();
    }
    ids[id] = true;
    return id;
  };
})();

// For memory leak, from aralejs
$(window).unload(function() {
  var uid;
  for(uid in cachedInstances) {
    cachedInstances[uid].destroy();
  }
});

/**
 * 通过 element 取 widget 实例
 *
 * @method get
 * @return {Mixed} selector
 * @static
 */
Widget.get = function (selector) {
  var element = $(selector).eq(0), uid;
  element.length &amp;&amp; (uid = element.attr(DATA_WIDGET_UNIQUEID));
  return cachedInstances[uid];
};

module.exports = Widget;

});

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
